#
# Override for dev environment
#

services:
  app:
    build:
      target: base
      context: ./
      dockerfile: ./docker/app/Dockerfile # Relative to `context`
      args:
        DOCKER_BUILDKIT: 1
    restart: no
    pull_policy: build
    labels:
      - traefik.http.routers.cfe-${DOCKER_IMAGE_TAG:?}.rule=Host(`soliloan.localhost`)
    environment:
      - NODE_ENV=development
      - AUTH_URL=https://soliloan.localhost
      - DATABASE_URL=${DATABASE_URL:?}
      # File Watching Optimierung f√ºr Docker auf Mac
      - WATCHPACK_POLLING=true
      - CHOKIDAR_USEPOLLING=true
      - CHOKIDAR_INTERVAL=1000
    volumes:
      - ./:/app:cached
      - /app/node_modules
    command: /bin/sh -c "pnpm install && pnpm prisma db push --accept-data-loss && pnpm prisma db seed && pnpm dev"
