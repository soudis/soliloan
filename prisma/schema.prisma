generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Account {
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  user              User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@id([provider, providerAccountId])
}

model Session {
  sessionToken String   @unique
  userId       String
  expires      DateTime
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model User {
  id            String         @id @default(cuid())
  name          String
  email         String?        @unique
  emailVerified DateTime?
  language      Language       @default(de)
  theme         SoliLoansTheme @default(default)
  password      String?
  image         String?
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  isAdmin       Boolean?
  lastLogin     DateTime?
  lastInvited   DateTime?
  passwordResetToken String?
  passwordResetTokenExpiresAt DateTime?
  accounts      Account[]
  lenders       Lender[]
  notes         Note[]
  files         File[]
  sessions      Session[]
  views         View[]
  managerOf     Project[]      @relation("ProjectManager")
}

model LoanTemplate {
  id                    String              @id @default(cuid())
  configurationId       String
  name                  String
  isDefault             Boolean             @default(false)
  terminationType       TerminationType
  terminationPeriod     Int?
  terminationPeriodType DurationType?
  duration              Int?
  durationType          DurationType?
  endDate               DateTime?
  minInterestRate       Float?
  maxInterestRate       Float?
  minAmount             Float?
  maxAmount             Float?
  configuration         Configuration       @relation(fields: [configurationId], references: [id])
}

model Configuration {
  id                     String            @id @default(cuid())
  name                   String
  logo                   String?
  email                  String?
  telNo                  String?
  website                String?
  street                 String?
  addon                  String?
  zip                    String?
  place                  String?
  country                Country?
  iban                   String?
  bic                    String?
  userLanguage           Language?
  userTheme              SoliLoansTheme?
  lenderRequiredFields   LenderRequiredField[]
  lenderSalutation       Salutation?
  lenderCountry          Country?
  interestMethod         InterestMethod
  altInterestMethods     InterestMethod[]
  defaultLoanTemplateId  String?
  loanTemplates          LoanTemplate[]
  project                Project?
  lenderAdditionalFields Json           @default("[]")
  loanAdditionalFields   Json           @default("[]")
}

model Project {
  id              String         @id @default(cuid())
  slug            String         @unique
  configurationId String         @unique
  changes         Change[]
  lenders         Lender[]
  configuration   Configuration  @relation(fields: [configurationId], references: [id], onDelete: Cascade)
  managers        User[]         @relation("ProjectManager")
}

model Lender {
  id               String            @id @default(cuid())
  lenderNumber     Int               @unique @default(autoincrement())
  projectId        String
  type             LenderType
  salutation       Salutation
  firstName        String?
  lastName         String?
  organisationName String?
  titlePrefix      String?
  titleSuffix      String?
  street           String?
  addon            String?
  zip              String?
  place            String?
  country          Country?
  telNo            String?
  email            String?
  iban             String?
  bic              String?
  files            File[]
  user             User?             @relation(fields: [email], references: [email])
  project          Project           @relation(fields: [projectId], references: [id])
  loans            Loan[]
  notes            Note[]
  additionalFields Json?
}

model Loan {
  id                    String              @id @default(cuid())
  loanNumber            Int                 @unique @default(autoincrement())
  lenderId              String
  signDate              DateTime
  terminationType       TerminationType
  endDate               DateTime?
  terminationDate       DateTime?
  terminationPeriod     Int?
  terminationPeriodType DurationType?
  duration              Int?
  durationType          DurationType?
  amount                Float
  interestRate          Float
  altInterestMethod     InterestMethod?
  contractStatus        ContractStatus
  files                 File[]
  lender                Lender              @relation(fields: [lenderId], references: [id], onDelete: Cascade)
  notes                 Note[]
  transactions          Transaction[]       
  additionalFields      Json?
}

model Transaction {
  id          String          @id @default(cuid())
  loanId      String
  type        TransactionType
  date        DateTime
  amount      Float
  paymentType PaymentType
  loan        Loan            @relation(fields: [loanId], references: [id], onDelete: Cascade)
}

model File {
  id          String  @id @default(cuid())
  mimeType    String
  name        String
  data        Bytes
  public      Boolean
  description String?
  thumbnail   Bytes?
  lenderId    String
  loanId      String?
  lender      Lender  @relation(fields: [lenderId], references: [id])
  loan        Loan?   @relation(fields: [loanId], references: [id])
  createdAt   DateTime @default(now())
  createdById String
  createdBy   User   @relation(fields: [createdById], references: [id])
}

model Note {
  id          String   @id @default(cuid())
  text        String
  public      Boolean
  lenderId    String
  loanId      String?
  createdById String
  createdAt   DateTime
  createdBy   User     @relation(fields: [createdById], references: [id])
  lender      Lender   @relation(fields: [lenderId], references: [id])
  loan        Loan?    @relation(fields: [loanId], references: [id])
}

enum Operation {
  CREATE
  UPDATE
  DELETE
}

enum Entity {
  project
  lender
  loan
  transaction
  file
  note
}


model Change {
  id          String    @id @default(cuid())
  primaryKey  String
  projectId   String
  project     Project   @relation(fields: [projectId], references: [id])
  before      Json
  after       Json
  context     Json
  entity      Entity
  operation   Operation
  committedAt DateTime
}


model View {
  id        String   @id @default(cuid())
  userId    String
  type      ViewType
  name      String
  data      Json
  isDefault Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id])
}

model VerificationToken {
  identifier String
  token      String
  expires    DateTime

  @@id([identifier, token])
}

enum LenderType {
  PERSON
  ORGANISATION
}

enum Salutation {
  PERSONAL
  FORMAL
}

enum ViewType {
  LENDER
  LOAN
  LOGBOOK
  PROJECT
}

enum TerminationType {
  ENDDATE
  TERMINATION
  DURATION
}


enum InterestMethod {
  ACT_365_NOCOMPOUND
  E30_360_NOCOMPOUND
  ACT_360_NOCOMPOUND
  ACT_ACT_NOCOMPOUND
  ACT_365_COMPOUND
  E30_360_COMPOUND
  ACT_360_COMPOUND
  ACT_ACT_COMPOUND
}

enum ContractStatus {
  PENDING
  COMPLETED
}

enum DurationType {
  MONTHS
  YEARS
}

enum TransactionType {
  INTEREST
  DEPOSIT
  WITHDRAWAL
  TERMINATION
  INTERESTPAYMENT
  NOTRECLAIMEDPARTIAL
  NOTRECLAIMED
}

enum PaymentType {
  BANK
  CASH
  OTHER
}

enum Language {
  de
  en
}

enum SoliLoansTheme {
  default
  ocean
  forest
  sunset
  lavender
}

enum Country {
  DE
  AT
  CH
  US
  GB
  FR
  IT
  ES
  NL
  BE
  DK
  SE
  NO
  FI
  PL
  CZ
  HU
  RO
  BG
  HR
  SI
  SK
  EE
  LV
  LT
  CY
  MT
  LU
  IE
  PT
  GR
}

enum LenderRequiredField {
  address
  email
  telNo
  }